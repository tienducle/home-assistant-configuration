###
# Notification: Open windows
- id: wohnzimmer_feuchtigkeit
  alias: Wohnzimmer Feuchtigkeit
  hide_entity: true
  trigger:
    - platform: numeric_state
      entity_id: sensor.wohnzimmer_humidity
      value_template: '{{ float(state.state) }}'
      above: 60
    - platform: numeric_state
      entity_id: sensor.dark_sky_humidity
      below: 60
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.wohnzimmer_humidity
        value_template: >
          {% if is_state('sensor.wohnzimmer_humidity', 'nan') %}
            0.0
          {% else %}
            {{ states('sensor.wohnzimmer_humidity') }}
          {% endif %}
        above: 60
      - condition: numeric_state
        entity_id: sensor.dark_sky_humidity
        below: 60
      - condition: state
        entity_id: binary_sensor.someone_at_home
        state: 'True'
  action:
    service: notify.telegram
    data:
      message: Wohnzimmer sollte gelueftet werden! (Luftfeuchtigkeit {{ states('sensor.wohnzimmer_humidity') }}%)

- id: schlafzimmer_feuchtigkeit
  alias: Schlafzimmer Feuchtigkeit
  hide_entity: true
  trigger:
    - platform: numeric_state
      entity_id: sensor.schlafzimmer_humidity
      above: 60
    - platform: numeric_state
      entity_id: sensor.dark_sky_humidity
      below: 60
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.schlafzimmer_humidity
        value_template: >
          {% if is_state('sensor.schlafzimmer_humidity', 'nan') %}
            0.0
          {% else %}
            {{ states('sensor.schlafzimmer_humidity') }}
          {% endif %}
        above: 60
      - condition: numeric_state
        entity_id: sensor.dark_sky_humidity
        below: 60
      - condition: state
        entity_id: binary_sensor.someone_at_home
        state: 'True'
  action:
    service: notify.telegram
    data:
      message: Schlafzimmer sollte gelueftet werden! (Luftfeuchtigkeit {{ states('sensor.schlafzimmer_humidity') }}%)

- id: kueche_feuchtigkeit
  alias: Kueche Feuchtigkeit
  hide_entity: true
  trigger:
    - platform: numeric_state
      entity_id: sensor.kueche_humidity
      above: 60
    - platform: numeric_state
      entity_id: sensor.dark_sky_humidity
      below: 60
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.kueche_humidity
        value_template: >
          {% if is_state('sensor.kueche_humidity', 'nan') %}
            0.0
          {% else %}
            {{ states('sensor.kueche_humidity') }}
          {% endif %}
        above: 60
      - condition: numeric_state
        entity_id: sensor.dark_sky_humidity
        below: 60
      - condition: state
        entity_id: binary_sensor.someone_at_home
        state: 'True'
  action:
    service: notify.telegram
    data:
      message: Kueche sollte gelueftet werden! (Luftfeuchtigkeit {{ states('sensor.kueche_humidity') }}%)

###
# Notification: Close windows;
# todo: distinguish between different states
- id: badezimmer_fenster
  alias: Badezimmer Fenster
  trigger:
    - platform: state
      entity_id: binary_sensor.oeq0164835_state
      from: 'off'
      to: 'on'
      for:
        minutes: 15
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.dark_sky_temperature
        below: 10
  action:
    service: notify.telegram
    data:
      message: Badezimmer Fenster sollte nun geschlossen werden!

- id: schlafzimmer_fenster
  alias: Schlafzimmer Fenster
  trigger:
    - platform: state
      entity_id: binary_sensor.oeq0167636_state
      from: 'off'
      to: 'on'
      for:
        minutes: 12
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.dark_sky_temperature
        below: 10
  action:
    service: notify.telegram
    data:
      message: Schlafzimmer Fenster sollte nun geschlossen werden!

- id: wohnzimmer_fenster
  alias: Wohnzimmer Fenster
  trigger:
    - platform: state
      entity_id: binary_sensor.oeq0166378_state
      from: 'off'
      to: 'on'
      for:
        minutes: 12
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.dark_sky_temperature
        below: 10
  action:
    service: notify.telegram
    data:
      message: Wohnzimmer Fenster sollte nun geschlossen werden!

